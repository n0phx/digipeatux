#!/bin/sh
#
# Check for internet connection periodically and restart network service if failure threshold is met

NAME=netcheck
PIDFILE=/var/run/$NAME.pid
LOGFILE=/var/log/$NAME.log
DAEMON=/usr/bin/netcheck

start(){
        printf "Starting $NAME: "
        start-stop-daemon --start --quiet  --make-pidfile --pidfile $PIDFILE --background \
                          --startas /bin/sh -- -c "exec $DAEMON > $LOGFILE 2>&1"
        [ $? = 0 ] && echo "OK" || echo "FAIL"
}

stop(){
        printf "Stopping $NAME: "
        start-stop-daemon --stop --quiet --pidfile $PIDFILE --name $NAME
        [ $? = 0 ] && echo "OK" || echo "FAIL"
}

case "$1" in
        start)
                start
                ;;
        stop)
                stop
                ;;
        restart)
                stop
                start
                ;;
        *)
                echo "Usage: $0 {start|stop|restart}"
                exit 1
                ;;
esac
